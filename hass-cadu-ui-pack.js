var A=["entity","name","image","velocidade","altitude","condition"];function j(a){if(!a||typeof a!="object"||Array.isArray(a))return{entity:"",name:"",image:"",image_rotated:"",velocidade:"",altitude:"",condition:"",rastro:!1,rastro_duracao_min:null,rastro_pontos_por_min:null,rastro_cor:"",rastro_max_pontos:null};try{let t=Object.keys(a).filter(e=>/^\d+$/.test(e)),i={entity:a.entity||"",name:a.name||"",image:a.image||"",image_rotated:a.image_rotated||"",velocidade:a.velocidade||"",altitude:a.altitude||"",condition:a.condition||"",rastro:a.rastro===!0,rastro_duracao_min:typeof a.rastro_duracao_min=="number"?a.rastro_duracao_min:null,rastro_pontos_por_min:typeof a.rastro_pontos_por_min=="number"?a.rastro_pontos_por_min:null,rastro_cor:a.rastro_cor||"",rastro_max_pontos:typeof a.rastro_max_pontos=="number"?a.rastro_max_pontos:null};return Object.keys(a).forEach(e=>{!/^\d+$/.test(e)&&i[e]===void 0&&(i[e]=a[e])}),t.length>0&&t.forEach(e=>{let o=Number(e);if(isNaN(o)||o<0||o>=A.length)return;let r=A[o];r&&i[r]===""&&a[e]&&(i[r]=a[e])}),i}catch(t){return console.error("Erro ao normalizar entidade:",t,a),{entity:a.entity||"",name:a.name||"",image:a.image||"",image_rotated:a.image_rotated||"",velocidade:a.velocidade||"",altitude:a.altitude||"",condition:a.condition||"",rastro:a.rastro===!0,rastro_duracao_min:typeof a.rastro_duracao_min=="number"?a.rastro_duracao_min:null,rastro_pontos_por_min:typeof a.rastro_pontos_por_min=="number"?a.rastro_pontos_por_min:null,rastro_cor:a.rastro_cor||"",rastro_max_pontos:typeof a.rastro_max_pontos=="number"?a.rastro_max_pontos:null,...a}}}function O(a){return Array.isArray(a)?a.filter(t=>t&&typeof t=="object").map(t=>{try{return j(t)}catch(i){return console.error("Erro ao normalizar entidade:",i,t),t}}):[]}var S=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._styleElement=document.createElement("style"),this.shadowRoot.appendChild(this._styleElement),this.controlsContainer=document.createElement("div"),this.controlsContainer.className="map-controls",this.shadowRoot.appendChild(this.controlsContainer),this.mapContainer=document.createElement("div"),this.mapContainer.id="map",this.shadowRoot.appendChild(this.mapContainer),this.markers={},this.infoBoxes={},this.lastPositions={},this.trails={},this.trailPolylines={},this._lastMapTypeOptions=null,this._lastMapControlsOptions=null,this._historyLoaded={},this._uiState={trafficEnabled:!1,nightModeEnabled:!1,followEnabled:!1,trafficOverride:!1,nightModeOverride:!1,followOverride:!1,rotateImageEnabled:!1,arrowEnabled:!0,entityVisibility:{}},this._updateStyles()}_updateStyles(){var m,p,g,d;let t=((m=this._config)==null?void 0:m.max_height)||null,i=((p=this._config)==null?void 0:p.max_width)||null,e="450px",o="600px",r=t?`${t}px`:e,s=t?`${t}px`:o,_=i?`max-width: ${i}px;`:"",c=((g=this._config)==null?void 0:g.mostrar_menu)!==!1,n=((d=this._config)==null?void 0:d.ocultar_creditos)===!0;this._styleElement.textContent=`
      :host {
        display: block;
        position: relative;
        ${_}
      }
      #map {
        width: 100%;
        height: ${r};
        border-radius: 0 0 6px 6px;
        overflow: hidden;
      }

      @media (min-width: 768px) {
        #map {
          height: ${s};
        }
      }
      .info-box {
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 2px 5px;
        border-radius: 3px;
        display: inline-block;
        white-space: nowrap;
        transform: translate(-50%, -100%);
        position: absolute;
        text-align: center;
        /* Permitir cliques na info box se necessario */
        pointer-events: none; 
      }
      .info-box .arrow-box {
        font-size: 15px;
      }
      .info-box .velocidade {
        font-size: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 24px;
      }
      .info-box .altitude {
        font-size: 12px;
      }
      .map-controls {
        display: flex;
        ${c?"":"display: none;"}
        flex-wrap: wrap;
        gap: 8px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px 6px 0 0;
        font-size: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 0;
      }
      .map-controls label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        white-space: nowrap;
      }
      .map-controls .entity-toggle {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      @media (max-width: 768px) {
        .map-controls {
          flex-direction: column;
          gap: 6px;
          padding: 6px 8px;
        }
      }
      ${n?`
      /* Oculta barra inferior/termos/creditos do Google Maps */
      .gm-style-cc,
      .gmnoprint,
      .gm-style a[href^="https://maps.google.com/maps"],
      .gm-style a[href^="https://www.google.com/intl/"],
      .gm-style .gm-style-cc {
        display: none !important;
      }`:""}
    `}_getStorageKey(){return!this._config||!this._config.entities?"google-maps-car-card-cadu-default":`google-maps-car-card-cadu-${this._config.entities.map(i=>i.entity).sort().join(",")}`}_loadUIState(){try{let t=this._getStorageKey(),i=localStorage.getItem(t);if(i){let e=JSON.parse(i);e&&typeof e=="object"&&(this._uiState={trafficEnabled:e.trafficEnabled===!0,nightModeEnabled:e.nightModeEnabled===!0,followEnabled:e.followEnabled===!0,trafficOverride:e.trafficOverride===!0,nightModeOverride:e.nightModeOverride===!0,followOverride:e.followOverride===!0,rotateImageEnabled:e.rotateImageEnabled===!0,arrowEnabled:e.arrowEnabled!==!1,entityVisibility:e.entityVisibility||{}})}}catch(t){console.error("Erro ao carregar estado do UI do localStorage:",t)}}_saveUIState(){try{let t=this._getStorageKey();localStorage.setItem(t,JSON.stringify(this._uiState))}catch(t){console.error("Erro ao salvar estado do UI no localStorage:",t)}}async _loadHistoryForEntities(){var i;if(!this._hass||!((i=this._config)!=null&&i.entities))return;let t=Date.now();for(let e of this._config.entities){let o=e.entity;if(!o||this._config.historico_somente_rastro!==!1&&e.rastro!==!0||this._historyLoaded[o]===!0)continue;this._historyLoaded[o]=!0;let r=Number.isFinite(e.rastro_duracao_min)?e.rastro_duracao_min:60,s=new Date(t-r*60*1e3).toISOString();try{let _=await this._hass.callApi("GET",`history/period/${s}?filter_entity_id=${o}&significant_changes_only=0`),c=Array.isArray(_)?_[0]:[],n=[];Array.isArray(c)&&c.forEach(d=>{var u,b;let l=(u=d==null?void 0:d.attributes)==null?void 0:u.latitude,y=(b=d==null?void 0:d.attributes)==null?void 0:b.longitude;if(typeof l=="number"&&typeof y=="number"){let f=new Date(d.last_updated||d.last_changed||d.timestamp).getTime();n.push({lat:l,lng:y,ts:f})}}),n.sort((d,l)=>d.ts-l.ts);let m=Number.isFinite(this._config.historico_limite_pontos)?this._config.historico_limite_pontos:null,p=m?this._sampleHistoryPoints(n,m):n;this.trails[o]=p;let g=this._findLastSignificantRotation(p);if(g!==null){let d=p[p.length-1];this.lastPositions[o]={lat:d.lat,lng:d.lng,rotation:g}}this._renderTrail(o,e)}catch(_){console.error("Erro ao carregar hist\xF3rico do HA:",_,o)}}}_getTrailConfig(t){return{enabled:t.rastro===!0,durationMin:Number.isFinite(t.rastro_duracao_min)?t.rastro_duracao_min:60,maxPerMin:Number.isFinite(t.rastro_pontos_por_min)?t.rastro_pontos_por_min:10,color:this._normalizeTrailColor(t.rastro_cor),maxPoints:Number.isFinite(t.rastro_max_pontos)?t.rastro_max_pontos:600}}_normalizeTrailColor(t){if(Array.isArray(t)&&t.length>=3){let[i,e,o]=t,r=s=>Math.max(0,Math.min(255,Number(s)||0)).toString(16).padStart(2,"0");return`#${r(i)}${r(e)}${r(o)}`}return typeof t=="string"&&t.trim()!==""?t.trim():"#00aaff"}_sampleHistoryPoints(t,i){if(!Array.isArray(t)||t.length<=i)return t;let e=Math.ceil(t.length/i),o=[];for(let s=0;s<t.length;s+=e)o.push(t[s]);let r=t[t.length-1];return o[o.length-1]!==r&&o.push(r),o}_findLastSignificantRotation(t){if(!Array.isArray(t)||t.length<2)return null;for(let i=t.length-1;i>0;i-=1){let e=t[i],o=t[i-1],r=e.lng-o.lng,s=e.lat-o.lat;if(Math.abs(r)>1e-5||Math.abs(s)>1e-5)return Math.atan2(s,r)*(180/Math.PI)}return null}_pruneTrail(t,i,e){let o=Date.now(),r=t.filter(s=>o-s.ts<=i);return r.length>e&&(r=r.slice(r.length-e)),r}_reduceTrailDensity(t,i){let e=Date.now(),o=t.slice(),r=_=>_.filter(c=>e-c.ts<=6e4).length,s=0;for(;r(o)>i&&o.length>2&&s<5;)o=o.filter((_,c)=>c%2===0||c===o.length-1),s+=1;return o}_recordTrailPoint(t,i,e){let o=this._getTrailConfig(e),r=Array.isArray(this.trails[t])?this.trails[t]:[],s=r[r.length-1],_=s?Math.abs(i.lng()-s.lng):1/0,c=s?Math.abs(i.lat()-s.lat):1/0;if(s&&_<=1e-5&&c<=1e-5)return;let n=r.concat([{lat:i.lat(),lng:i.lng(),ts:Date.now()}]),m=o.durationMin*60*1e3,p=this._pruneTrail(n,m,o.maxPoints);p=this._reduceTrailDensity(p,o.maxPerMin),this.trails[t]=p}_clearTrail(t){let i=this.trailPolylines[t];Array.isArray(i)&&i.forEach(e=>e.setMap(null)),delete this.trailPolylines[t]}_renderTrail(t,i){let e=this._getTrailConfig(i);if(!e.enabled){this._clearTrail(t);return}let o=this.trails[t];if(!Array.isArray(o)||o.length<2){this._clearTrail(t);return}this._clearTrail(t);let r=[],s=.9,_=.1,c=o.length-1;for(let n=1;n<o.length;n++){let m=n/c,p=_+m*(s-_),g=new google.maps.Polyline({path:[{lat:o[n-1].lat,lng:o[n-1].lng},{lat:o[n].lat,lng:o[n].lng}],geodesic:!0,strokeColor:e.color,strokeOpacity:p,strokeWeight:3,map:this._map});r.push(g)}this.trailPolylines[t]=r}set hass(t){this._hass=t,this._map&&this._config&&(this._updateMap(),this._applyMapTypeOptions(),this._applyNightMode(),this._toggleTrafficLayer())}setConfig(t){try{let i=this._normalizeConfig(t||{});if(this._config=i,(!this._config.entities||!this._config.api_key)&&console.warn("Configuracao incompleta: api_key ou entities ausentes"),this._config={...this._config,transito:typeof this._config.transito=="string"?this._config.transito:null,modo_noturno:typeof this._config.modo_noturno=="string"?this._config.modo_noturno:null,follow_entity:typeof this._config.follow_entity=="string"?this._config.follow_entity:null,rotate_image:this._config.rotate_image===!0,mostrar_menu:this._config.mostrar_menu!==!1,mostrar_tipo_mapa:this._config.mostrar_tipo_mapa!==!1,tipo_mapa:typeof this._config.tipo_mapa=="string"?this._config.tipo_mapa:"roadmap",mostrar_tela_cheia:this._config.mostrar_tela_cheia!==!1,mostrar_controles_navegacao:this._config.mostrar_controles_navegacao!==!1,ocultar_creditos:this._config.ocultar_creditos===!0,transito_on:this._config.transito_on===!0,modo_noturno_on:this._config.modo_noturno_on===!0,seguir_on:this._config.seguir_on===!0,rotacao_on:this._config.rotacao_on===!0,historico_somente_rastro:this._config.historico_somente_rastro!==!1,historico_carregar_no_start:this._config.historico_carregar_no_start!==!1,historico_recarregar:this._config.historico_recarregar===!0,historico_limite_pontos:Number.isFinite(this._config.historico_limite_pontos)?this._config.historico_limite_pontos:null},this._loadUIState(),this._uiState.trafficEnabled===void 0&&(this._uiState.trafficEnabled=!1),this._uiState.nightModeEnabled===void 0&&(this._uiState.nightModeEnabled=!1),this._uiState.followEnabled===void 0&&(this._uiState.followEnabled=!1),this._uiState.trafficOverride===void 0&&(this._uiState.trafficOverride=!1),this._uiState.nightModeOverride===void 0&&(this._uiState.nightModeOverride=!1),this._uiState.followOverride===void 0&&(this._uiState.followOverride=!1),this._uiState.rotateImageEnabled===void 0&&(this._uiState.rotateImageEnabled=!1),this._uiState.arrowEnabled===void 0&&(this._uiState.arrowEnabled=!0),this._config.mostrar_menu===!1&&(this._config.transito||(this._uiState.trafficEnabled=this._config.transito_on===!0),this._config.modo_noturno||(this._uiState.nightModeEnabled=this._config.modo_noturno_on===!0),this._config.follow_entity||(this._uiState.followEnabled=this._config.seguir_on===!0),this._uiState.rotateImageEnabled=this._config.rotacao_on===!0),this._initializeEntityVisibility(),this._updateStyles(),this._map&&this.controlsContainer&&(this._renderControls(),requestAnimationFrame(()=>{this._applyNightMode(),this._toggleTrafficLayer(),this._applyMapTypeOptions(),this._applyMapControlsOptions()})),this._map&&this._config.historico_recarregar===!0&&(this._historyLoaded={},this._loadHistoryForEntities()),!this._config.api_key){this.mapContainer.innerHTML='<div style="padding: 20px; color: white;">Configure a API Key do Google Maps</div>';return}if(!window.google||!window.google.maps){let e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${this._config.api_key}`,e.onload=()=>{this._initializeMap()},document.head.appendChild(e)}else this._initializeMap()}catch(i){console.error("Erro ao definir configura\xE7\xE3o no card:",i)}}_normalizeConfig(t){if(!t||typeof t!="object")return{api_key:"",follow_entity:"",entities:[]};try{let i=O(t.entities||[]);return{...t,entities:i}}catch(i){return t}}_applyMapTypeOptions(){if(!this._map)return;let t=this._config.tipo_mapa||"roadmap",i=this._config.mostrar_tipo_mapa!==!1,e=`${t}|${i}`;this._lastMapTypeOptions!==e&&(this._lastMapTypeOptions=e,this._map.setOptions({mapTypeId:t,mapTypeControl:i}))}_applyMapControlsOptions(){if(!this._map)return;let t=this._config.mostrar_tela_cheia!==!1,i=this._config.mostrar_controles_navegacao!==!1,e=`${t}|${i}`;this._lastMapControlsOptions!==e&&(this._lastMapControlsOptions=e,this._map.setOptions({fullscreenControl:t,zoomControl:i}))}getCardSize(){return 6}_initializeMap(){this.mapContainer&&(this._map=new google.maps.Map(this.mapContainer,{center:{lat:-30.0277,lng:-51.2287},zoom:17,streetViewControl:!1,mapTypeControl:this._config.mostrar_tipo_mapa!==!1,mapTypeId:this._config.tipo_mapa||"roadmap",fullscreenControl:this._config.mostrar_tela_cheia!==!1,zoomControl:this._config.mostrar_controles_navegacao!==!1}),this._renderControls(),setTimeout(()=>{this._applyNightMode()},50),this._config.historico_carregar_no_start!==!1&&this._loadHistoryForEntities().then(()=>{this._config.entities&&this._config.entities.forEach(t=>{this._addOrUpdateMarker(t)})}),this._config.entities&&this._config.entities.forEach(t=>{this._addOrUpdateMarker(t)}),this._shouldFollow()&&this._fitMapBounds(),this.trafficLayer=new google.maps.TrafficLayer,this._toggleTrafficLayer())}_updateMap(){this._config.entities&&(this._config.entities.forEach(t=>{this._addOrUpdateMarker(t)}),this._shouldFollow()&&this._fitMapBounds())}_shouldFollow(){if(this._config.follow_entity&&this._config.follow_entity!==""){let t=this._hass.states[this._config.follow_entity];if(!this._uiState.followOverride)return t&&t.state==="on"}return this._config.mostrar_menu===!1&&!this._config.follow_entity?this._config.seguir_on===!0:this._uiState.followEnabled}_applyNightMode(){var o;if(!this._map)return;if(!this._hass&&this._config.modo_noturno&&typeof this._config.modo_noturno=="string"&&this._config.modo_noturno!==""){setTimeout(()=>this._applyNightMode(),100);return}let t=[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}],i=this._config.modo_noturno,e=this._uiState.nightModeEnabled;typeof i=="string"&&i!==""&&!this._uiState.nightModeOverride?e=((o=this._hass.states[i])==null?void 0:o.state)==="on":!i&&this._config.mostrar_menu===!1&&this._config.modo_noturno_on===!0&&(e=!0),this._map.setOptions({styles:e?t:[]})}_toggleTrafficLayer(){var e;if(!this.trafficLayer)return;let t=this._config.transito,i=this._uiState.trafficEnabled;typeof t=="string"&&t!==""&&!this._uiState.trafficOverride?i=((e=this._hass.states[t])==null?void 0:e.state)==="on":!t&&this._config.mostrar_menu===!1&&this._config.transito_on===!0&&(i=!0),i?this.trafficLayer.setMap(this._map):this.trafficLayer.setMap(null)}_addOrUpdateMarker(t){if(!this._hass||!this._hass.states)return;let i=this._hass.states[t.entity],e=t.condition?this._hass.states[t.condition]:null,o=t.condition?e&&e.state==="on":this._uiState.entityVisibility[t.entity]!==!1;if(i&&i.state!=="unavailable"&&o){if(!i.attributes.latitude||!i.attributes.longitude)return;let r=new google.maps.LatLng(i.attributes.latitude,i.attributes.longitude),s=this.markers[t.entity],_=this._getInfoBoxText(t),c,n=this.lastPositions[t.entity],m=0,p=0;n?(m=r.lng()-n.lng,p=r.lat()-n.lat,Math.abs(m)>1e-5||Math.abs(p)>1e-5?c=Math.atan2(p,m)*(180/Math.PI):c=n.rotation!==999?n.rotation:999):c=999;let g=this._getArrowFromRotation(c);this.lastPositions[t.entity]={lat:r.lat(),lng:r.lng(),rotation:c},this._recordTrailPoint(t.entity,r,t);let d=this._getEntityDisplayName(t,i),l=this._uiState.rotateImageEnabled===!0;if(l?s&&s instanceof google.maps.Marker&&(s.setMap(null),s=null):s&&typeof s.draw=="function"&&!(s instanceof google.maps.Marker)&&(s.setMap(null),s=null),l){let u=0;c!==999?u=180-c:u=0;let b=t.image_rotated||t.image||i.attributes.entity_picture||"";if(s){s.position=r,s.rotation=u;let f=b;s.imageUrl!==f&&(s.imageUrl=f,s.img_&&(s.img_.src=f)),s.draw()}else{let f=b,v=document.createElement("img");v.src=f,v.style.width="60px",v.style.height="60px",v.style.transform=`rotate(${u}deg)`,s=new google.maps.OverlayView,s.position=r,s.rotation=u,s.imageUrl=f,s.onAdd=function(){let h=document.createElement("div");h.style.position="absolute",h.style.width="60px",h.style.height="60px",h.style.cursor="pointer";let x=document.createElement("img");x.src=this.imageUrl,x.style.width="100%",x.style.height="100%",x.style.position="absolute",x.style.top="0",x.style.left="0",h.appendChild(x),this.div_=h,this.img_=x,this.getPanes().overlayLayer.appendChild(h)},s.draw=function(){let h=this.getProjection();if(!h||!this.position)return;let x=h.fromLatLngToDivPixel(this.position),w=this.div_;w&&(w.style.left=x.x-30+"px",w.style.top=x.y-30+"px",w.style.transform=`rotate(${this.rotation}deg)`)},s.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},s.getPosition=function(){return this.position},s.setMap(this._map),this.markers[t.entity]=s}}else if(s)s.setPosition(r),s.setTitle(d);else{let u={url:t.image||i.attributes.entity_picture||"",scaledSize:new google.maps.Size(60,60),anchor:new google.maps.Point(30,30)};s=new google.maps.Marker({position:r,map:this._map,title:d,icon:u}),this.markers[t.entity]=s}this.infoBoxes[t.entity]&&this.infoBoxes[t.entity].setMap(null);let y=new google.maps.OverlayView;y.onAdd=function(){let u=document.createElement("div");u.className="info-box";let b=this._parent._uiState.arrowEnabled?`<div class="arrow-box">${g} <!-- seta --></div>`:"";u.innerHTML=`
          ${b}
          ${_}
        `,this.div_=u,this.getPanes().overlayLayer.appendChild(u)},y._parent=this,y.draw=function(){let b=this.getProjection().fromLatLngToDivPixel(r),f=this.div_,v=0,h=-50;if(l&&(h=-65),l&&c!==999){let x=180-c,w=65,T=w,E=x*(Math.PI/180);v=w*Math.sin(E),h=-T*Math.cos(E)}f.style.left=`${b.x+v}px`,f.style.top=`${b.y+h}px`,f.style.transform="translate(-50%, -50%)"},y.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},y.setMap(this._map),this.infoBoxes[t.entity]=y,this._renderTrail(t.entity,t),this._shouldFollow()&&this._centerOnMarkerWithPadding(r)}else this.markers[t.entity]&&(this.markers[t.entity].setMap(null),delete this.markers[t.entity]),this.infoBoxes[t.entity]&&(this.infoBoxes[t.entity].setMap(null),delete this.infoBoxes[t.entity]),this._clearTrail(t.entity)}_initializeEntityVisibility(){!this._config||!this._config.entities||this._config.entities.forEach(t=>{t.entity in this._uiState.entityVisibility||(this._uiState.entityVisibility[t.entity]=!0)})}_renderControls(){var p,g,d,l,y,u,b,f,v;if(!this.controlsContainer||(this.controlsContainer.innerHTML="",this._config.mostrar_menu===!1))return;let t=document.createElement("label"),i=document.createElement("input");i.type="checkbox",typeof this._config.transito=="string"&&this._config.transito!==""&&!this._uiState.trafficOverride?i.checked=((d=(g=(p=this._hass)==null?void 0:p.states)==null?void 0:g[this._config.transito])==null?void 0:d.state)==="on":i.checked=this._uiState.trafficEnabled,i.addEventListener("change",()=>{this._uiState.trafficOverride=!0,this._uiState.trafficEnabled=i.checked,this._saveUIState(),this._toggleTrafficLayer()}),t.appendChild(i),t.appendChild(document.createTextNode("Transito")),this.controlsContainer.appendChild(t);let e=document.createElement("label"),o=document.createElement("input");o.type="checkbox",typeof this._config.modo_noturno=="string"&&this._config.modo_noturno!==""&&!this._uiState.nightModeOverride?o.checked=((u=(y=(l=this._hass)==null?void 0:l.states)==null?void 0:y[this._config.modo_noturno])==null?void 0:u.state)==="on":o.checked=this._uiState.nightModeEnabled,o.addEventListener("change",()=>{this._uiState.nightModeOverride=!0,this._uiState.nightModeEnabled=o.checked,this._saveUIState(),this._applyNightMode()}),e.appendChild(o),e.appendChild(document.createTextNode("Modo noturno")),this.controlsContainer.appendChild(e);let r=document.createElement("label"),s=document.createElement("input");s.type="checkbox",typeof this._config.follow_entity=="string"&&this._config.follow_entity!==""&&!this._uiState.followOverride?s.checked=((v=(f=(b=this._hass)==null?void 0:b.states)==null?void 0:f[this._config.follow_entity])==null?void 0:v.state)==="on":s.checked=this._uiState.followEnabled,s.addEventListener("change",()=>{this._uiState.followOverride=!0,this._uiState.followEnabled=s.checked,this._saveUIState(),this._shouldFollow()&&this._fitMapBounds()}),r.appendChild(s),r.appendChild(document.createTextNode("Seguir")),this.controlsContainer.appendChild(r);let _=document.createElement("label"),c=document.createElement("input");c.type="checkbox",c.checked=this._uiState.rotateImageEnabled,c.addEventListener("change",()=>{this._uiState.rotateImageEnabled=c.checked,this._saveUIState(),this._config.entities&&this._config.entities.forEach(h=>{this._addOrUpdateMarker(h)})}),_.appendChild(c),_.appendChild(document.createTextNode("Rota\xE7\xE3o")),this.controlsContainer.appendChild(_);let n=document.createElement("input");n.type="checkbox",n.checked=this._uiState.arrowEnabled,n.addEventListener("change",()=>{this._uiState.arrowEnabled=n.checked,this._saveUIState(),this._config.entities&&this._config.entities.forEach(h=>{this._addOrUpdateMarker(h)})});let m=document.createElement("label");m.appendChild(n),m.appendChild(document.createTextNode("Seta")),this.controlsContainer.appendChild(m),this._config.entities&&this._config.entities.forEach(h=>{var z,I;if(h.condition)return;let x=(I=(z=this._hass)==null?void 0:z.states)==null?void 0:I[h.entity],w=this._getEntityDisplayName(h,x),T=document.createElement("label");T.className="entity-toggle";let E=document.createElement("input");E.type="checkbox",E.checked=this._uiState.entityVisibility[h.entity]!==!1,E.addEventListener("change",()=>{this._uiState.entityVisibility[h.entity]=E.checked,this._saveUIState(),this._addOrUpdateMarker(h)}),T.appendChild(E),T.appendChild(document.createTextNode(w)),this.controlsContainer.appendChild(T)})}_getArrowFromRotation(t){return t>=-22.5&&t<22.5?"&rarr;":t>=22.5&&t<67.5?"&nearr;":t>=67.5&&t<112.5?"&uarr;":t>=112.5&&t<157.5?"&nwarr;":t>=157.5&&t<500||t<-157.5?"&larr;":t>=-157.5&&t<-112.5?"&swarr;":t>=-112.5&&t<-67.5?"&darr;":t>=-67.5&&t<-22.5?"&searr;":"&bull;"}_getEntityDisplayName(t,i){var e;return t.name?t.name:((e=i==null?void 0:i.attributes)==null?void 0:e.friendly_name)||t.entity}_getInfoBoxText(t){let i="";if(t.velocidade&&this._hass&&this._hass.states[t.velocidade]){let e=parseFloat(this._hass.states[t.velocidade].state).toFixed(0);i+=`<div class="velocidade"> ${e} km/h</div>`}if(t.altitude&&this._hass&&this._hass.states[t.altitude]){let e=parseFloat(this._hass.states[t.altitude].state).toFixed(0);i+=`<div class="altitude"> &#9650; ${e} m</div>`}return i}_fitMapBounds(){if(!this._map||!this.markers||Object.keys(this.markers).length===0)return;let t=new google.maps.LatLngBounds;Object.values(this.markers).forEach(e=>{t.extend(e.getPosition())});let i=this._shouldFollow()?{top:100,right:50,bottom:50,left:50}:0;this._map.fitBounds(t,i),google.maps.event.addListenerOnce(this._map,"bounds_changed",()=>{this._map.getZoom()>18&&this._map.setZoom(18)})}_centerOnMarkerWithPadding(t){if(!this._map)return;let i=new google.maps.LatLngBounds;i.extend(t);let e=.002,o=.001;i.extend(new google.maps.LatLng(t.lat()+e,t.lng())),i.extend(new google.maps.LatLng(t.lat()-e*.3,t.lng())),i.extend(new google.maps.LatLng(t.lat(),t.lng()+o)),i.extend(new google.maps.LatLng(t.lat(),t.lng()-o)),this._map.fitBounds(i,{top:100,right:50,bottom:50,left:50}),google.maps.event.addListenerOnce(this._map,"bounds_changed",()=>{this._map.getZoom()>18&&this._map.setZoom(18)})}};var L=class extends HTMLElement{constructor(){super(),this._updating=!1}setConfig(t){try{let i=this._normalizeConfig(t||{});this._config=i,this._rendered&&this._hass?this._syncFormData():!this._rendered&&this._hass&&this._render()}catch(i){console.error("Erro ao definir configura\xE7\xE3o:",i,t),this._config=t||{},this._rendered&&this._hass&&this._syncFormData()}}set hass(t){this._hass=t,this._hass&&(this._rendered&&!this._updating?this._syncFormData():!this._rendered&&this._config&&this._render())}_render(){if(!this._hass)return;this._rendered=!0,this.innerHTML="";let t=document.createElement("ha-form");t.hass=this._hass;let i=this._normalizeConfig(this._config||{}),e;try{e=JSON.parse(JSON.stringify(i))}catch(o){console.error("Erro ao criar c\xF3pia dos dados:",o),e={...i}}e.api_key=e.api_key||"",e.follow_entity=e.follow_entity||"",e.modo_noturno=e.modo_noturno||"",e.transito=e.transito||"",e.mostrar_menu=e.mostrar_menu!==!1,e.mostrar_tipo_mapa=e.mostrar_tipo_mapa!==!1,e.tipo_mapa=e.tipo_mapa||"roadmap",e.mostrar_tela_cheia=e.mostrar_tela_cheia!==!1,e.mostrar_controles_navegacao=e.mostrar_controles_navegacao!==!1,e.ocultar_creditos=e.ocultar_creditos===!0,e.transito_on=e.transito_on===!0,e.modo_noturno_on=e.modo_noturno_on===!0,e.seguir_on=e.seguir_on===!0,e.rotacao_on=e.rotacao_on===!0,e.historico_somente_rastro=e.historico_somente_rastro!==!1,e.historico_carregar_no_start=e.historico_carregar_no_start!==!1,e.historico_recarregar=e.historico_recarregar===!0,e.historico_limite_pontos=Number.isFinite(e.historico_limite_pontos)?e.historico_limite_pontos:null,e.max_height=e.max_height||null,e.max_width=e.max_width||null,e.entities=e.entities||[],t.schema=this._buildSchema(),t.computeLabel=o=>o.label||o.name,t.data=e,t.addEventListener("value-changed",o=>{if(!this._updating)try{this._updating=!0,this._dispatchConfigChanged(o.detail.value)}catch(r){console.error("Erro ao processar mudan\xE7a de valor:",r)}finally{setTimeout(()=>{this._updating=!1},100)}}),this.appendChild(t),this._form=t,requestAnimationFrame(()=>{this._form&&this._form.data!==e&&(this._form.data=e)})}_syncFormData(){if(this._form&&!this._updating&&this._hass)try{this._updating=!0,this._form.hass=this._hass;let t=this._normalizeConfig(this._config||{}),i;try{i=JSON.parse(JSON.stringify(t))}catch(e){i={...t}}this._form.data=i}catch(t){console.error("Erro ao sincronizar dados do form:",t,this._config)}finally{setTimeout(()=>{this._updating=!1},50)}}_buildSchema(){return[{name:"api_key",label:"Google Maps API Key",required:!0,selector:{text:{}}},{name:"follow_entity",label:"Entidade para seguir (booleana, opcional)",selector:{entity:{domain:"input_boolean"}}},{name:"modo_noturno",label:"Entidade modo noturno (opcional)",selector:{entity:{domain:"input_boolean"}}},{name:"transito",label:"Entidade transito (opcional)",selector:{entity:{domain:"input_boolean"}}},{name:"transito_on",label:"Transito ligado (sem entidade)",selector:{boolean:{}}},{name:"mostrar_menu",label:"Mostrar menu superior (opcional)",selector:{boolean:{}}},{name:"mostrar_tipo_mapa",label:"Mostrar bot\xF5es Mapa/Sat\xE9lite (opcional)",selector:{boolean:{}}},{name:"mostrar_tela_cheia",label:"Mostrar bot\xE3o tela cheia (opcional)",selector:{boolean:{}}},{name:"mostrar_controles_navegacao",label:"Mostrar controles de navega\xE7\xE3o (opcional)",selector:{boolean:{}}},{name:"ocultar_creditos",label:"Ocultar cr\xE9ditos/termos do mapa (opcional)",selector:{boolean:{}}},{name:"historico_somente_rastro",label:"Hist\xF3rico: carregar s\xF3 se rastro ativo",selector:{boolean:{}}},{name:"historico_carregar_no_start",label:"Hist\xF3rico: carregar ao iniciar",selector:{boolean:{}}},{name:"historico_recarregar",label:"Hist\xF3rico: recarregar ao alterar config",selector:{boolean:{}}},{name:"historico_limite_pontos",label:"Hist\xF3rico: limite de pontos (opcional)",selector:{number:{min:10,max:1e4,step:10}}},{name:"modo_noturno_on",label:"Modo noturno ligado (sem entidade)",selector:{boolean:{}}},{name:"seguir_on",label:"Seguir ligado (sem entidade)",selector:{boolean:{}}},{name:"rotacao_on",label:"Rota\xE7\xE3o ligada (sem menu)",selector:{boolean:{}}},{name:"tipo_mapa",label:"Tipo de mapa (opcional)",selector:{select:{options:[{label:"Mapa",value:"roadmap"},{label:"Sat\xE9lite",value:"satellite"},{label:"H\xEDbrido",value:"hybrid"},{label:"Terreno",value:"terrain"}]}}},{name:"max_height",label:"Altura m\xE1xima do mapa em pixels (opcional)",selector:{number:{min:100,max:2e3,step:10,unit_of_measurement:"px"}}},{name:"max_width",label:"Largura m\xE1xima do mapa em pixels (opcional)",selector:{number:{min:100,max:2e3,step:10,unit_of_measurement:"px"}}},{name:"entities",label:"Entidades",selector:{object:{multiple:!0,label_field:"entity",fields:{entity:{label:"Entidade",required:!0,selector:{entity:{}}},name:{label:"Nome personalizado (opcional)",selector:{text:{}}},image:{label:"Imagem (opcional)",selector:{text:{}}},image_rotated:{label:"Imagem Rotacionada (opcional, beta)",selector:{text:{}}},rastro:{label:"Rastro (opcional)",selector:{boolean:{}}},rastro_duracao_min:{label:"Rastro: dura\xE7\xE3o em minutos (opcional)",selector:{number:{min:1,max:1440,step:1,unit_of_measurement:"min"}}},rastro_pontos_por_min:{label:"Rastro: pontos por minuto (opcional)",selector:{number:{min:1,max:120,step:1}}},rastro_max_pontos:{label:"Rastro: m\xE1ximo de pontos (opcional)",selector:{number:{min:10,max:1e4,step:10}}},rastro_cor:{label:"Rastro: cor (opcional)",selector:{color_rgb:{}}},velocidade:{label:"Sensor de velocidade (opcional)",selector:{entity:{}}},altitude:{label:"Sensor de altitude (opcional)",selector:{entity:{}}},condition:{label:"Condicao (opcional)",selector:{entity:{domain:"input_boolean"}}}}}}}]}_normalizeConfig(t){if(!t||typeof t!="object")return{api_key:"",follow_entity:"",max_height:null,max_width:null,entities:[]};try{let i=O(t.entities||[]),e={api_key:t.api_key||"",follow_entity:t.follow_entity||"",modo_noturno:t.modo_noturno||"",transito:t.transito||"",mostrar_menu:t.mostrar_menu!==!1,mostrar_tipo_mapa:t.mostrar_tipo_mapa!==!1,tipo_mapa:t.tipo_mapa||"roadmap",mostrar_tela_cheia:t.mostrar_tela_cheia!==!1,mostrar_controles_navegacao:t.mostrar_controles_navegacao!==!1,ocultar_creditos:t.ocultar_creditos===!0,transito_on:t.transito_on===!0,modo_noturno_on:t.modo_noturno_on===!0,seguir_on:t.seguir_on===!0,rotacao_on:t.rotacao_on===!0,historico_somente_rastro:t.historico_somente_rastro!==!1,historico_carregar_no_start:t.historico_carregar_no_start!==!1,historico_recarregar:t.historico_recarregar===!0,historico_limite_pontos:Number.isFinite(t.historico_limite_pontos)?t.historico_limite_pontos:null,max_height:t.max_height||null,max_width:t.max_width||null,entities:i};return Object.keys(t).forEach(o=>{e.hasOwnProperty(o)||(e[o]=t[o])}),e}catch(i){return console.error("Erro ao normalizar configura\xE7\xE3o:",i,t),{api_key:t.api_key||"",follow_entity:t.follow_entity||"",modo_noturno:t.modo_noturno||"",transito:t.transito||"",mostrar_menu:t.mostrar_menu!==!1,mostrar_tipo_mapa:t.mostrar_tipo_mapa!==!1,tipo_mapa:t.tipo_mapa||"roadmap",mostrar_tela_cheia:t.mostrar_tela_cheia!==!1,mostrar_controles_navegacao:t.mostrar_controles_navegacao!==!1,ocultar_creditos:t.ocultar_creditos===!0,transito_on:t.transito_on===!0,modo_noturno_on:t.modo_noturno_on===!0,seguir_on:t.seguir_on===!0,rotacao_on:t.rotacao_on===!0,historico_somente_rastro:t.historico_somente_rastro!==!1,historico_carregar_no_start:t.historico_carregar_no_start!==!1,historico_recarregar:t.historico_recarregar===!0,historico_limite_pontos:Number.isFinite(t.historico_limite_pontos)?t.historico_limite_pontos:null,max_height:t.max_height||null,max_width:t.max_width||null,entities:Array.isArray(t.entities)?t.entities:[]}}}_dispatchConfigChanged(t){if(!(!t||typeof t!="object"))try{let i=this._normalizeConfig(t);this._config=i,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:i},bubbles:!0,composed:!0}))}catch(i){console.error("Erro ao despachar mudan\xE7a de configura\xE7\xE3o:",i),this._config=t,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:t},bubbles:!0,composed:!0}))}}};customElements.get("google-maps-car-card-cadu")||customElements.define("google-maps-car-card-cadu",S);customElements.get("google-maps-car-card-cadu-editor")||customElements.define("google-maps-car-card-cadu-editor",L);S.getConfigElement=function(){return document.createElement("google-maps-car-card-cadu-editor")};S.getStubConfig=function(){return{api_key:"",follow_entity:"",entities:[]}};window.customCards=window.customCards||[];window.customCards.push({type:"google-maps-car-card-cadu",name:"Google Maps Car Card Cadu",description:"Exibe dispositivos no Google Maps com InfoBox personalizado."});var P=["entity","name","icon","show_state","tap_action"];function F(a){if(!a||typeof a!="object"||Array.isArray(a))return{entity:"",name:"",icon:"",show_state:!1,tap_action:{}};try{let t=Object.keys(a).filter(e=>/^\d+$/.test(e)),i={entity:a.entity||"",name:a.name||"",icon:a.icon||"",show_state:a.show_state===!0,tap_action:a.tap_action||{}};return Object.keys(a).forEach(e=>{!/^\d+$/.test(e)&&i[e]===void 0&&(i[e]=a[e])}),t.length>0&&t.forEach(e=>{let o=Number(e);if(isNaN(o)||o<0||o>=P.length)return;let r=P[o];r&&i[r]===""&&a[e]&&(i[r]=a[e])}),i}catch(t){return console.error("Erro ao normalizar entidade:",t,a),{entity:a.entity||"",name:a.name||"",icon:a.icon||"",show_state:a.show_state===!0,tap_action:a.tap_action||{},...a}}}function $(a){if(Array.isArray(a))return a.filter(t=>t!=null).map(t=>{try{return F(typeof t=="string"?{entity:t}:t)}catch(i){return console.error("Erro ao normalizar entidade:",i,t),t}});if(a&&typeof a=="object"){let i=Object.keys(a).filter(e=>/^\d+$/.test(e)).sort((e,o)=>Number(e)-Number(o)).map(e=>a[e]);if(i.length>0)return $(i)}return[]}function M(a){if(!a||typeof a!="object")return{title:"",image:"",image_media_content_id:"",image_entity:"",aspect_ratio:"1.5",fit_mode:"cover",camera_view:"auto",tap_action:{action:"more-info"},entities:[]};try{let t=$(a.entities||[]),i="";a.image&&typeof a.image=="object"&&(i=a.image.media_content_id||""),a.image_media_content_id&&(i=a.image_media_content_id);let e=i?{media_content_id:i}:typeof a.image=="string"?a.image:"",o={title:a.title||"",image:e,image_media_content_id:i,image_entity:a.image_entity||"",aspect_ratio:a.aspect_ratio||"1.5",fit_mode:a.fit_mode||"cover",camera_view:a.camera_view||"auto",tap_action:a.tap_action||{action:"more-info"},entities:t};return Object.keys(a).forEach(r=>{o.hasOwnProperty(r)||(o[r]=a[r])}),o}catch(t){console.error("Erro ao normalizar configura\xE7\xE3o:",t,a);let i="";a.image&&typeof a.image=="object"&&(i=a.image.media_content_id||""),a.image_media_content_id&&(i=a.image_media_content_id);let e=i?{media_content_id:i}:typeof a.image=="string"?a.image:"";return{title:a.title||"",image:e,image_media_content_id:i,image_entity:a.image_entity||"",aspect_ratio:a.aspect_ratio||"1.5",fit_mode:a.fit_mode||"cover",camera_view:a.camera_view||"auto",tap_action:a.tap_action||{action:"more-info"},entities:Array.isArray(a.entities)?a.entities:[]}}}var k=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._styleElement=document.createElement("style"),this.shadowRoot.appendChild(this._styleElement)}setConfig(t){this._config=M(t||{}),this._render()}set hass(t){this._hass=t,this._config&&this._render()}getCardSize(){return 3}_render(){var m,p,g,d;if(!this.shadowRoot)return;let t=this._parseAspectRatio((m=this._config)==null?void 0:m.aspect_ratio),i=((p=this._config)==null?void 0:p.fit_mode)||"cover";this._styleElement.textContent=`
      :host {
        display: block;
      }
      .picture-wrapper {
        position: relative;
        width: 100%;
        cursor: pointer;
      }
      .picture-spacer {
        display: block;
        padding-top: calc(100% / var(--po-aspect-ratio));
      }
      .picture-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: var(--po-fit-mode);
      }
      .overlay {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        padding: 10px 12px;
        gap: 12px;
        pointer-events: none;
      }
      .overlay-title {
        color: #fff;
        font-size: 18px;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
      }
      .overlay-entity {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: #fff;
        font-size: 14px;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
        pointer-events: auto;
      }
      .overlay-entity ha-icon {
        --mdc-icon-size: 18px;
      }
      .picture-placeholder {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--secondary-text-color);
        background: var(--secondary-background-color);
        font-size: 14px;
      }
    `;let e=document.createElement("ha-card"),o=document.createElement("div");o.className="picture-wrapper",o.style.setProperty("--po-aspect-ratio",String(t)),o.style.setProperty("--po-fit-mode",i),o.addEventListener("click",()=>{var l;this._handleAction((l=this._config)==null?void 0:l.tap_action,this._getPrimaryEntityId())});let r=document.createElement("div");r.className="picture-spacer",o.appendChild(r);let s=this._getImageUrl();if(s){let l=document.createElement("img");l.className="picture-image",l.src=s,l.alt=((g=this._config)==null?void 0:g.title)||"Imagem",o.appendChild(l)}else{let l=document.createElement("div");l.className="picture-placeholder",l.textContent="Configure image ou image_entity",o.appendChild(l)}let _=document.createElement("div");_.className="overlay";let c=((d=this._config)==null?void 0:d.title)||"";if(c){let l=document.createElement("div");l.className="overlay-title",l.textContent=c,_.appendChild(l)}else{let l=document.createElement("div");l.style.flex="1",_.appendChild(l)}let n=this._getOverlayEntityConfig();if(n){let l=document.createElement("div");l.className="overlay-entity",l.addEventListener("click",b=>{var v;b.stopPropagation();let f=n.tap_action||((v=this._config)==null?void 0:v.tap_action);this._handleAction(f,n.entity)});let y=document.createElement("ha-icon");y.icon=this._getEntityIcon(n),l.appendChild(y);let u=document.createElement("div");u.textContent=this._getEntityState(n.entity),l.appendChild(u),_.appendChild(l)}o.appendChild(_),e.appendChild(o),this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(this._styleElement),this.shadowRoot.appendChild(e)}_parseAspectRatio(t){if(!t||typeof t!="string")return 1.5;let i=t.trim();if(i.includes(":")){let[o,r]=i.split(":").map(s=>Number(s));if(Number.isFinite(o)&&Number.isFinite(r)&&o>0&&r>0)return o/r}let e=Number(i);return Number.isFinite(e)&&e>0?e:1.5}_getImageUrl(){var e,o,r,s,_,c;if((e=this._config)!=null&&e.image){if(typeof this._config.image=="string")return this._config.image;if(typeof this._config.image=="object")return this._config.image.media_content_id||""}let t=(o=this._config)==null?void 0:o.image_entity;if(!t||!this._hass)return"";let i=(r=this._hass.states)==null?void 0:r[t];if(!i)return"";if(((s=this._config)==null?void 0:s.camera_view)==="live"&&t.startsWith("camera.")){let n=typeof this._hass.hassUrl=="function"?this._hass.hassUrl:null,m=`/api/camera_proxy_stream/${t}`;return n?n(m):m}return((_=i.attributes)==null?void 0:_.entity_picture)||((c=i.attributes)==null?void 0:c.image)||(typeof i.state=="string"?i.state:"")}_getPrimaryEntityId(){var i;let t=Array.isArray((i=this._config)==null?void 0:i.entities)?this._config.entities:[];return t.length>0?t[0].entity:null}_getOverlayEntityConfig(){var e;let t=Array.isArray((e=this._config)==null?void 0:e.entities)?this._config.entities:[];return t.length===0?null:t.find(o=>(o==null?void 0:o.show_state)===!0)||t[0]}_getEntityName(t){var e,o,r;if(t!=null&&t.name)return t.name;let i=(o=(e=this._hass)==null?void 0:e.states)==null?void 0:o[t.entity];return((r=i==null?void 0:i.attributes)==null?void 0:r.friendly_name)||t.entity}_getEntityIcon(t){var e,o,r;if(t!=null&&t.icon)return t.icon;let i=(o=(e=this._hass)==null?void 0:e.states)==null?void 0:o[t.entity];return((r=i==null?void 0:i.attributes)==null?void 0:r.icon)||"mdi:checkbox-blank-circle-outline"}_getEntityState(t){var o,r,s;let i=(r=(o=this._hass)==null?void 0:o.states)==null?void 0:r[t];if(!i)return"unavailable";let e=(s=i.attributes)==null?void 0:s.unit_of_measurement;return e?`${i.state} ${e}`:i.state}_handleAction(t,i){if(!t||t.action==="none")return;let e=t.action||"more-info";if(e==="more-info"){let o=t.entity||i;o&&this._fireEvent("hass-more-info",{entityId:o});return}if(e==="navigate"&&t.navigation_path){history.pushState(null,"",t.navigation_path),window.dispatchEvent(new Event("location-changed"));return}if(e==="url"&&t.url_path){window.location.href=t.url_path;return}if(e==="toggle"&&i&&this._hass){this._hass.callService("homeassistant","toggle",{entity_id:i});return}if(e==="call-service"&&t.service&&this._hass){let[o,r]=t.service.split(".");o&&r&&this._hass.callService(o,r,t.service_data||{})}}_fireEvent(t,i){this.dispatchEvent(new CustomEvent(t,{detail:i,bubbles:!0,composed:!0}))}};var N=class extends HTMLElement{constructor(){super(),this._updating=!1}setConfig(t){this._config=M(t||{}),this._rendered&&this._hass?this._syncFormData():!this._rendered&&this._hass&&this._render()}set hass(t){this._hass=t,this._hass&&(this._rendered&&!this._updating?this._syncFormData():!this._rendered&&this._config&&this._render())}_render(){if(!this._hass)return;this._rendered=!0,this.innerHTML="";let t=document.createElement("ha-form");t.hass=this._hass;let i=M(this._config||{}),e;try{e=JSON.parse(JSON.stringify(i))}catch(o){e={...i}}t.schema=this._buildSchema(),t.computeLabel=o=>o.label||o.name,t.data=e,t.addEventListener("value-changed",o=>{this._updating||(this._updating=!0,this._dispatchConfigChanged(o.detail.value),setTimeout(()=>{this._updating=!1},100))}),this.appendChild(t),this._form=t}_syncFormData(){if(!(!this._form||this._updating||!this._hass))try{this._updating=!0,this._form.hass=this._hass;let t=M(this._config||{}),i;try{i=JSON.parse(JSON.stringify(t))}catch(e){i={...t}}this._form.data=i}finally{setTimeout(()=>{this._updating=!1},50)}}_buildSchema(){return[{name:"title",label:"Titulo",selector:{text:{}}},{name:"image",label:"Imagem (url/local)",selector:{text:{}}},{name:"image_media_content_id",label:"Imagem (media_content_id)",selector:{text:{}}},{name:"image_entity",label:"Entidade de imagem (opcional)",selector:{entity:{}}},{name:"aspect_ratio",label:"Aspect ratio (ex: 1.5 ou 16:9)",selector:{text:{}}},{name:"fit_mode",label:"Fit mode",selector:{select:{options:[{label:"Cover",value:"cover"},{label:"Contain",value:"contain"}]}}},{name:"camera_view",label:"Camera view",selector:{select:{options:[{label:"Auto",value:"auto"},{label:"Live",value:"live"}]}}},{name:"tap_action",label:"Tap action",selector:{action:{}}},{name:"entities",label:"Entidades",selector:{object:{multiple:!0,label_field:"entity",fields:{entity:{label:"Entidade",required:!0,selector:{entity:{}}},name:{label:"Nome (opcional)",selector:{text:{}}},icon:{label:"Icone (opcional)",selector:{icon:{}}},show_state:{label:"Mostrar estado",selector:{boolean:{}}},tap_action:{label:"Tap action (opcional)",selector:{action:{}}}}}}}]}_dispatchConfigChanged(t){if(!t||typeof t!="object")return;let i=M(t);this._config=i,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:i},bubbles:!0,composed:!0}))}};customElements.get("picture-overview-cadu")||customElements.define("picture-overview-cadu",k);customElements.get("picture-overview-cadu-editor")||customElements.define("picture-overview-cadu-editor",N);k.getConfigElement=function(){return document.createElement("picture-overview-cadu-editor")};k.getStubConfig=function(){return{title:"Picture Overview",aspect_ratio:"1.5",fit_mode:"cover",entities:[]}};window.customCards=window.customCards||[];window.customCards.push({type:"picture-overview-cadu",name:"Picture Overview Cadu",description:"Imagem com entities e tap_action estilo picture-glance."});
