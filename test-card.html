<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Google Maps Car Card Cadu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #03a9f4;
        }
        .card-container {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .config-section {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .config-section h2 {
            margin-top: 0;
            color: #03a9f4;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #03a9f4;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background: #0288d1;
        }
        .error {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .info {
            color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Simulador - Google Maps Car Card Cadu</h1>
        
        <div class="config-section">
            <h2>Configura√ß√£o</h2>
            <p>Cole sua chave da API do Google Maps e configure as entidades:</p>
            <textarea id="configInput">{
  "type": "custom:google-maps-car-card-cadu",
  "api_key": "SUA_CHAVE_API_AQUI",
  "follow_entity": "",
  "entities": [
    {
      "entity": "device_tracker.song_plus_premium_cadu",
      "image": "/local/songplus.png",
      "velocidade": "sensor.electro_song_cadu_speed",
      "altitude": "sensor.electro_song_cadu_location_altitude",
      "name": "SONG"
    },
    {
      "entity": "device_tracker.seal",
      "image": "/local/seal.png",
      "velocidade": "sensor.electro_seal_speed",
      "altitude": "sensor.electro_seal_location_altitude",
      "name": "SEAL"
    }
  ]
}</textarea>
            <button onclick="loadCard()">Carregar Card</button>
            <div id="status"></div>
        </div>

        <div class="card-container">
            <div id="card-placeholder"></div>
        </div>
    </div>

    <!-- Simular ambiente Home Assistant -->
    <script>
        // Simular objeto hass do Home Assistant
        window.hass = {
            states: {
                'device_tracker.song_plus_premium_cadu': {
                    state: 'home',
                    attributes: {
                        latitude: -30.0277,
                        longitude: -51.2287,
                        friendly_name: 'SONG Plus Premium',
                        entity_picture: null
                    }
                },
                'device_tracker.seal': {
                    state: 'home',
                    attributes: {
                        latitude: -30.0300,
                        longitude: -51.2300,
                        friendly_name: 'SEAL',
                        entity_picture: null
                    }
                },
                'sensor.electro_song_cadu_speed': {
                    state: '45',
                    attributes: {
                        unit_of_measurement: 'km/h',
                        friendly_name: 'Velocidade SONG'
                    }
                },
                'sensor.electro_seal_speed': {
                    state: '60',
                    attributes: {
                        unit_of_measurement: 'km/h',
                        friendly_name: 'Velocidade SEAL'
                    }
                },
                'sensor.electro_song_cadu_location_altitude': {
                    state: '150',
                    attributes: {
                        unit_of_measurement: 'm',
                        friendly_name: 'Altitude SONG'
                    }
                },
                'sensor.electro_seal_location_altitude': {
                    state: '200',
                    attributes: {
                        unit_of_measurement: 'm',
                        friendly_name: 'Altitude SEAL'
                    }
                }
            }
        };

        // Simular customElements se n√£o existir
        if (!window.customElements) {
            window.customElements = {
                define: function(name, constructor) {
                    console.log('Registrando custom element:', name);
                }
            };
        }

        // Simular ha-form se necess√°rio
        if (!customElements.get('ha-form')) {
            class HaForm extends HTMLElement {
                constructor() {
                    super();
                    this._hass = null;
                    this._data = {};
                    this._schema = [];
                }
                
                set hass(value) {
                    this._hass = value;
                    this._updateForm();
                }
                
                set data(value) {
                    this._data = value || {};
                    this._updateForm();
                }
                
                set schema(value) {
                    this._schema = value || [];
                    this._updateForm();
                }
                
                _updateForm() {
                    this.innerHTML = '<div style="padding: 20px; background: #1e1e1e; border-radius: 4px;"><p style="color: #03a9f4;">Editor de Configura√ß√£o (ha-form simulado)</p><pre style="color: #fff; font-size: 12px;">' + JSON.stringify(this._data, null, 2) + '</pre></div>';
                }
            }
            customElements.define('ha-form', HaForm);
        }

        function loadCard() {
            const statusDiv = document.getElementById('status');
            const placeholder = document.getElementById('card-placeholder');
            const configText = document.getElementById('configInput').value;
            
            try {
                // Limpar placeholder
                placeholder.innerHTML = '';
                statusDiv.innerHTML = '';
                
                // Parse da configura√ß√£o
                let config;
                try {
                    config = JSON.parse(configText);
                } catch (e) {
                    throw new Error('JSON inv√°lido: ' + e.message);
                }
                
                if (!config.api_key || config.api_key === 'SUA_CHAVE_API_AQUI') {
                    statusDiv.innerHTML = '<div class="error">‚ö†Ô∏è Por favor, insira sua chave da API do Google Maps!</div>';
                    return;
                }
                
                // Carregar script do Google Maps se ainda n√£o carregou
                if (!window.google || !window.google.maps) {
                    statusDiv.innerHTML = '<div class="info">‚è≥ Carregando Google Maps API...</div>';
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${config.api_key}`;
                    script.onload = () => {
                        loadCardScript();
                    };
                    script.onerror = () => {
                        statusDiv.innerHTML = '<div class="error">‚ùå Erro ao carregar Google Maps API. Verifique sua chave.</div>';
                    };
                    document.head.appendChild(script);
                } else {
                    loadCardScript();
                }
                
                function loadCardScript() {
                    // Carregar o script do card
                    const cardScript = document.createElement('script');
                    cardScript.src = 'google-maps-car-card-cadu.js';
                    cardScript.onload = () => {
                        // Criar o card
                        const card = document.createElement('google-maps-car-card-cadu');
                        card.setConfig(config);
                        card.hass = window.hass;
                        
                        placeholder.appendChild(card);
                        statusDiv.innerHTML = '<div class="info">‚úÖ Card carregado com sucesso!</div>';
                    };
                    cardScript.onerror = () => {
                        statusDiv.innerHTML = '<div class="error">‚ùå Erro ao carregar o script do card. Certifique-se de que o arquivo est√° no mesmo diret√≥rio.</div>';
                    };
                    document.head.appendChild(cardScript);
                }
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="error">‚ùå Erro: ' + error.message + '</div>';
                console.error(error);
            }
        }

        // Atualizar posi√ß√µes periodicamente para simular movimento
        setInterval(() => {
            if (window.hass && window.hass.states) {
                // Simular pequeno movimento
                const song = window.hass.states['device_tracker.song_plus_premium_cadu'];
                if (song) {
                    song.attributes.latitude += (Math.random() - 0.5) * 0.001;
                    song.attributes.longitude += (Math.random() - 0.5) * 0.001;
                }
                
                const seal = window.hass.states['device_tracker.seal'];
                if (seal) {
                    seal.attributes.latitude += (Math.random() - 0.5) * 0.001;
                    seal.attributes.longitude += (Math.random() - 0.5) * 0.001;
                }
                
                // Atualizar velocidades
                const songSpeed = window.hass.states['sensor.electro_song_cadu_speed'];
                if (songSpeed) {
                    songSpeed.state = String(Math.max(0, parseInt(songSpeed.state) + Math.floor((Math.random() - 0.5) * 5)));
                }
                
                const sealSpeed = window.hass.states['sensor.electro_seal_speed'];
                if (sealSpeed) {
                    sealSpeed.state = String(Math.max(0, parseInt(sealSpeed.state) + Math.floor((Math.random() - 0.5) * 5)));
                }
                
                // Atualizar card se existir
                const card = document.querySelector('google-maps-car-card-cadu');
                if (card) {
                    card.hass = window.hass;
                }
            }
        }, 2000);
    </script>
</body>
</html>
